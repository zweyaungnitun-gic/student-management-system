<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>確認ページ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Desktop view - normal table */
        @media (min-width: 768px) {
            .data-table {
                display: table;
                width: 100%;
            }
            .data-row {
                display: table-row;
            }
            .data-label, .data-value {
                display: table-cell;
                padding: 0.75rem 1rem;
                border: 1px solid #dee2e6;
            }
            .data-label {
                background-color: #f8f9fa;
                width: 30%;
                font-weight: 600;
            }
        }

        /* Mobile view - card style */
        @media (max-width: 767px) {
            .data-table {
                display: block;
            }
            .data-row {
                display: block;
                margin-bottom: 1rem;
                background: white;
                border: 1px solid #dee2e6;
                border-radius: 0.375rem;
                overflow: hidden;
            }
            .data-label, .data-value {
                display: block;
                padding: 0.75rem 1rem;
            }
            .data-label {
                background-color: #f8f9fa;
                font-weight: 600;
                border-bottom: 1px solid #dee2e6;
            }
            .data-value {
                background: white;
            }
        }
    </style>
</head>
<body class="bg-light">

    <div class="container py-5">
        <div class="card p-4 mx-auto rounded-3 shadow-sm" style="max-width: 900px;">
            <div class="card-body">
                
                <div class="text-center mb-4">
                    <div class="d-inline-flex align-items-center justify-content-center bg-white mb-3" 
                         style="width: 100px; height: 100px; overflow: hidden;">
                        <img src="/images/registration/image.png" alt="Logo" class="w-100 h-100" style="object-fit: cover;">
                    </div>
                    
                    <h2 class="text-primary fw-bold pb-2 border-bottom border-light mb-4">
                        登録データ確認
                    </h2>
                </div>

                <div class="mx-2 mx-md-5">
                    <div class="data-table">
                        <!-- Basic / Personal -->
                        <div class="data-row">
                            <div class="data-label">なまえ(英語)</div>
                            <div class="data-value" th:text="${studentData.englishName ?: '—'}">John Doe</div>
                        </div>
                        <div class="data-row">
                            <div class="data-label">なまえ(カタカナ)</div>
                            <div class="data-value" th:text="${studentData.katakanaName ?: '—'}">ジョン・ドウ</div>
                        </div>
                        <div class="data-row">
                            <div class="data-label">生年月日</div>
                            <div class="data-value" th:text="${studentData.dob ?: '—'}">2000-01-01</div>
                        </div>
                        <div class="data-row">
                            <div class="data-label">性別</div>
                            <div class="data-value" th:text="${studentData.gender ?: '—'}">Male</div>
                        </div>

                        <!-- Contact / Address -->
                        <div class="data-row">
                            <div class="data-label">現在場所</div>
                            <div class="data-value" th:text="${studentData.currentAddress ?: '—'}">123 Tokyo Street</div>
                        </div>
                        <div class="data-row">
                            <div class="data-label">出身地住所</div>
                            <div class="data-value" th:text="${studentData.hometownAddress ?: '—'}">456 Osaka Street</div>
                        </div>
                        <div class="data-row">
                            <div class="data-label">電話番号</div>
                            <div class="data-value" th:text="${studentData.phoneNumber ?: '—'}">090-1234-5678</div>
                        </div>
                        <div class="data-row">
                            <div class="data-label">保護者電話番号</div>
                            <div class="data-value" th:text="${studentData.guardianPhoneNumber ?: '—'}">090-8765-4321</div>
                        </div>

                        <!-- Family / Documents -->
                        <div class="data-row">
                            <div class="data-label">父親名</div>
                            <div class="data-value" th:text="${studentData.fatherName ?: '—'}">Michael Doe</div>
                        </div>
                        <div class="data-row">
                            <div class="data-label">パスポート番号</div>
                            <div class="data-value" th:text="${studentData.passportNumber ?: '—'}">AB1234567</div>
                        </div>
                        <div class="data-row">
                            <div class="data-label">国民 ID 番号</div>
                            <div class="data-value" th:text="${studentData.nationalIdNumber ?: '—'}">JP-123456789</div>
                        </div>

                        <!-- Skills / Career -->
                        <div class="data-row">
                            <div class="data-label">現在のJLPT合格レベル</div>
                            <div class="data-value" th:text="${studentData.jlptLevel ?: '—'}">N4</div>
                        </div>
                        <div class="data-row">
                            <div class="data-label">希望職種</div>
                            <div class="data-value" th:text="${studentData.desiredOccupation ?: '—'}">介護</div>
                        </div>
                        <div class="data-row">
                            <div class="data-label">その他職種</div>
                            <div class="data-value" th:text="${studentData.otherOccupation ?: '—'}">—</div>
                        </div>

                        <!-- Experience -->
                        <div class="data-row">
                            <div class="data-label">日本渡航経験</div>
                            <div class="data-value" th:text="${studentData.japanTravelExperience ?: '—'}">ない</div>
                        </div>
                        <div class="data-row">
                            <div class="data-label">COE申請経験</div>
                            <div class="data-value" th:text="${studentData.coeApplicationExperience ?: '—'}">ない</div>
                        </div>

                        <!-- Additional Questions (third page fields) -->
                        <div class="data-row">
                            <div class="data-label">宗教</div>
                            <div class="data-value" th:text="${studentData.religion == 'その他' ? (studentData.otherReligion ?: 'その他') : (studentData.religion ?: '—')}">仏教</div>
                        </div>
                        <div class="data-row">
                            <div class="data-label">喫煙</div>
                            <div class="data-value" th:text="${studentData.smoking ?: '—'}">吸わない</div>
                        </div>
                        <div class="data-row">
                            <div class="data-label">飲酒</div>
                            <div class="data-value" th:text="${studentData.alcohol ?: '—'}">飲む</div>
                        </div>
                        <div class="data-row">
                            <div class="data-label">刺青（タトゥー）</div>
                            <div class="data-value" th:text="${studentData.tattoo ?: '—'}">ない</div>
                        </div>
                        <div class="data-row">
                            <div class="data-label">学費支払予定日</div>
                            <div class="data-value" th:text="${studentData.tuitionPaymentDate ?: '—'}">2025-01-01</div>
                        </div>
                        <div class="data-row">
                            <div class="data-label">寮希望</div>
                            <div class="data-value" th:text="${studentData.wantDorm ?: '—'}">はい</div>
                        </div>
                        <div class="data-row">
                            <div class="data-label">その他メモ</div>
                            <div class="data-value" th:text="${studentData.otherMemo ?: '—'}">—</div>
                        </div>
                    </div>
                </div>

                <!-- Buttons -->
                <div class="text-center pt-4 d-flex flex-column flex-sm-row justify-content-center gap-3">
                    <button type="button" class="btn btn-secondary btn-lg rounded py-2 px-4" 
                            onclick="window.location.href='/register'">
                        編集
                    </button>
                    <button type="button" class="btn btn-success btn-lg rounded py-2 px-4" 
                            onclick="submitFinalData()">
                        登録完了
                    </button>
                </div>

                <div class="text-center mt-5 pt-3 border-top border-light">
                    <small class="text-muted">
                        &copy; 2025 Global Innovation Consulting.Inc, All Rights Reserved.
                    </small>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        function submitFinalData() {
            // Call backend to save data permanently to database
            fetch('/register/submit-final', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.text())
            .then(data => {
                if (data === 'success') {
                    alert('登録が完了しました！');
                    window.location.href = '/register/success';
                } else {
                    alert('登録に失敗しました');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('登録に失敗しました');
            });
        }
    </script>
</body>
</html>